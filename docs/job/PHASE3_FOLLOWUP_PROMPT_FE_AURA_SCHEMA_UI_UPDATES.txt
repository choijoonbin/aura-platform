[PHASE3 Follow-up Prompt / Frontend] Aura 스키마 변화 대응(라벨/failed error 객체/제안 필드) + UX 반영
버전: v1.0 / 작성일: 2026-02-10
대상: dwp-frontend (React) 담당 Cursor
목적: Aura/BE가 확정한 Phase3 스키마 변화에 대해 FE 화면(스트림 탭/AI 분석 탭/액션 제안 탭)이 깨지지 않도록 UI/상태/표시 규칙을 반영한다.
전제: 운영 기본은 옵션 B(Backend SSE Proxy). FE는 BE streamUrl로 SSE 연결.

======================================================================
0) 결론(적용 범위)
- 스트림 탭: step 라벨 변경/추가를 그대로 표시(하드코딩 금지)
- failed 처리: error가 문자열이 아니라 {message, stage} 객체일 수 있음 → message를 기본 표시
- 액션 제안 탭: requiresApproval 배지 + checklist 영역(비어있으면 숨김)
- (선택) stage를 이용해 “재시도 안내 문구”를 다르게(예: rag 실패는 증거/문서 부족 안내)

======================================================================
1) SSE 이벤트 처리 규칙(필수)
1-1. step 라벨
- 서버가 주는 label을 그대로 렌더한다.
- 예: "RAG retrieve"(45%), "Propose actions"(80%), "Callback sending"(95%)
- FE가 라벨 리스트를 고정하지 않는다.

1-2. failed 이벤트 error 스키마
- payload 예시:
  data: { error: { message: "…", stage: "rag" } }
- FE 표시:
  - 사용자 메시지: error.message
  - 보조정보(선택): error.stage (작게 표시하거나 dev panel에만)
- 호환:
  - error가 string이면 그대로 표시
  - error가 object면 message 사용

1-3. completed 후 갱신
- completed 수신 시:
  - GET analysis?runId=...
  - GET action-proposals?runId=...
  자동 refetch

======================================================================
2) 액션 제안 카드 필드 반영(필수)
2-1. requiresApproval
- true면 “승인 필요” 뱃지 노출
- false면 “자동 가능(정책)” 등 뱃지(선택)

2-2. checklist
- checklist가 [] 또는 null이면 섹션 숨김
- 1개 이상이면 "추가 확인사항" 리스트로 표시
- (초기에는 빈 배열이 정상 → 빈 상태를 오류로 보지 말 것)

======================================================================
3) 테스트 플래그 UI 노출 정책(선택)
- 운영에서는 노출하지 않는다.
- dev/test에서만:
  - “실패 시나리오” 드롭다운(rag/llm) → BE에 query param 또는 header 전달
  - 단, FE는 Aura로 직접 전달하지 않고 BE에만 전달(옵션 B 준수)

======================================================================
4) DoD
- 스트림 탭에서 step 라벨이 변경되어도 UI가 깨지지 않음
- failed 이벤트에서 error 객체/문자열 모두 정상 표시
- 액션 제안 카드에서 requiresApproval/checklist가 자연스럽게 표시됨(빈 checklist는 숨김)
- completed 후 analysis/proposals 자동 갱신 확인
